# 校园网自动连接系统使用说明

## 功能特性

### 🌍 网络检测
- **双重检测机制**：结合ping测试和HTTP请求测试
- **多服务器测试**：分别测试Google和百度的连接性
- **智能判断**：自动判断网络是否正常连接

### 🔧 Clash管理
- **自动关闭**：检测到网络问题时自动关闭所有Clash相关进程
- **智能重启**：校园网连接成功后自动重新启动Clash
- **进程识别**：支持多种Clash客户端的进程检测
  - clash-verge.exe
  - clash.exe
  - Clash.for.Windows.exe
  - Clash.Meta.exe
  - v2rayN.exe

### ⚡ 性能优化
- **异步睡眠**：使用async/await减少CPU占用
- **定期检测**：每10分钟自动检测一次网络状态
- **异常处理**：完善的错误处理和恢复机制

### 📊 详细日志
- **实时日志**：显示详细的连接状态和操作信息
- **状态追踪**：记录登录成功、IP信息等关键状态

## 安装配置

### 1. 安装依赖
```bash
pip install -r requirements.txt
```

### 2. 配置参数
编辑`login.py`文件末尾的配置部分：

```yaml
# 配置信息 - 请修改为你的实际信息
username = "你的学号"           # 你的校园网账号
password = "你的密码"           # 你的校园网密码
clash_path = r"C:\Program Files\Clash Verge\clash-verge.exe"  # Clash安装路径
```

### 3. 运行程序
```bash
python login.py
```

## 配置说明

### Clash路径配置
如果你的Clash安装在不同的路径，请修改`clash_path`变量：

**常见路径：**
- `C:\Program Files\Clash Verge\clash-verge.exe`
- `C:\Program Files\Clash for Windows\Clash.for.Windows.exe`
- `C:\Users\你的用户名\AppData\Local\Clash\clash.exe`
- 自定义安装路径

### 检测间隔
默认每10分钟（600秒）检测一次网络，可以通过修改`check_interval`变量来调整：

```python
check_interval = 600  # 10分钟，单位：秒
```

## 使用场景

### 场景1：有Clash工具的用户
1. 配置好用户名密码和Clash路径
2. 运行程序后会：
   - 每10分钟检测网络
   - 发现断网时自动关闭Clash
   - 执行校园网登录
   - 登录成功后重启Clash

### 场景2：没有Clash工具的用户
1. 设置`has_clash = False`
2. 程序会：
   - 每10分钟检测网络
   - 发现断网时直接执行校园网登录
   - 无需处理Clash相关操作

## 日志查看

程序运行时会显示详细的日志信息，包括：
- 网络检测状态
- Clash进程管理
- 登录过程和结果
- IP地址信息
- 错误信息和恢复情况

## 退出程序

按 `Ctrl+C` 可以安全退出程序。

## 故障排除

### 1. 模块导入错误
确保已安装所有依赖：
```bash
pip install requests psutil
```

### 2. Clash无法启动
- 检查路径是否正确
- 确保Clash程序没有被杀毒软件阻止
- 尝试手动启动Clash确认程序正常

### 3. 网络检测失败
- 检查防火墙设置
- 确保能正常访问百度和Google
- 查看详细日志定位问题

### 4. 校园网登录失败
- 确认用户名密码正确
- 检查网络环境（是否在校园网覆盖范围内）
- 查看登录失败的具体错误信息

## 高级配置

### 命令行参数模式
如果需要通过命令行传递参数，可以取消main函数中相应代码的注释：

```python
# 如果需要使用命令行参数，取消下面的注释
if len(sys.argv) >= 4:
    username = sys.argv[1]
    password = sys.argv[2]
    has_clash = sys.argv[3].lower() == 'true'
    if len(sys.argv) > 4:
        clash_path = sys.argv[4]
```

使用方法：
```bash
python login.py 你的学号 你的密码 true "C:\Program Files\Clash Verge\clash-verge.exe"
```

### 自定义网络测试
可以修改`check_ping_connection()`和`check_request_connection()`函数来自定义网络检测逻辑。

### 添加更多Clash客户端
在`CLASH_EXECUTABLES`列表中添加新的客户端名称：
```python
CLASH_EXECUTABLES = [
    'clash-verge.exe',
    'clash.exe',
    # 添加你的Clash客户端
    '你的客户端.exe'
]
```

## 注意事项

1. **权限要求**：程序可能需要管理员权限来管理某些系统进程
2. **杀毒软件**：某些杀毒软件可能误报，建议添加到信任列表
3. **防火墙**：确保程序可以访问网络进行检测
4. **稳定性**：程序设计为长期运行，建议作为后台服务运行

## 技术支持

如遇到问题，请查看：
1. 程序输出的详细日志信息
2. Windows事件查看器中的相关错误
3. 网络和防火墙设置

希望这个系统能帮助您实现校园网的自动连接！
